<!DOCTYPE html>
<html lang="en">
  <head>
    <title>SoundStage: Checkout</title>
    <%- include("partials/head",{ styles: ["checkout", "partials"] }) %>
    <style>
      <% for (let i = 0; i < array.length; i++) { %>
        .card-items-<%= i %>.hidden {
          display: none;
        }
      <% } %>
    </style>
  </head>

  <body>
    <%- include("partials/header") %>

    <main>
      <div class="container">
        <div class="row justify-content-start">
          <!-- Informacion -->
          <div class="col-md-6">
            <div class="card">
              <div class="card text-bg-dark">
                <div class="card-img-overlay">
                  <h5 class="card-title">Resumen de compra</h5>
                  <hr style="width: 6vw;">
                  <h6 class="card-subtitle-mb-2 text-body-light">Subtotal: <span id="subtotal"></span></h6>
                  <hr style="color: white">

                  <% for (let i = 0; i < array.length; i++) { %>
                    <div class="card-items card-items-<%= i %>" id="product_<%= i %>">
                      <img class="image-info" src="https://picsum.photos/400/300" alt="asd" />
                      <p class="image-text a"><%= array[i].Name %></p> 
                      <p class="image-text b"><span id="quantity_<%= i %>"><%= array[i].Quantity %></span>x</p> 
                      <p class="image-text c"><%= array[i].Price %></p> 
                      <div class="zora">
                        <button class="btn btn-outline-success mipha" type="button">
                          <i class="fas fa-plus"></i>
                        </button>
                        <button class="btn btn-outline-success daruk" type="button">
                          <i class="fas fa-times"></i>
                        </button>
                        <button class="btn btn-outline-success tulin" type="button">
                          <i class="fas fa-minus"></i>
                        </button>
                      </div>
                    </div>
                  <% } %>
                  
                  
                </div>
              </div>
            </div>
          </div>

          <!-- Acordion -->
          <form class="col-md-6" action="">
            <div class="row row-cols-1">
              <div class="accordion accordion-flush" id="accordionFlush">
                <!-- Acordion Item 1 -->
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#flush-collapseOne"
                      aria-expanded="false"
                      aria-controls="flush-collapseOne"
                    >
                      Datos de contacto
                    </button>
                  </h2>
                  <div
                    id="flush-collapseOne"
                    class="accordion-collapse collapse"
                    data-bs-parent="#accordionFlush"
                  >
                    <div class="accordion-body">
                      <div class="form-floating mb-3">
                        <input
                          type="text"
                          class="form-control"
                          id="floatingInput"
                          placeholder="a"
                          required
                        />
                        <label for="floatingInput">Nombre y Apellido</label>
                      </div>
                      <div class="form-floating mb-3">
                        <input
                          type="number"
                          class="form-control"
                          id="floatingInput"
                          placeholder="a"
                          required
                        />
                        <label for "floatingInput">Numero de telefono</label>
                      </div>
                      <div class="form-floating mb-3">
                        <input
                          type="email"
                          class="form-control"
                          id="floatingInput"
                          placeholder="a"
                          required
                        />
                        <label for="floatingInput">E-mail</label>
                      </div>
                      <div class="form-floating mb-3">
                        <input
                          type="number"
                          class="form-control"
                          id="floatingInput"
                          placeholder="a"
                          required
                        />
                        <label for="floatingInput">DNI</label>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Acordion Item 2 -->
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#flush-collapseTwo"
                      aria-expanded="false"
                      aria-controls="flush-collapseTwo"
                    >
                      Datos de facturacion
                    </button>
                  </h2>
                  <div
                    id="flush-collapseTwo"
                    class="accordion-collapse collapse"
                    data-bs-parent="#accordionFlush"
                  >
                    <div class="accordion-body">
                      <div class="form-floating mb-3">
                        <input
                          type="text"
                          class="form-control"
                          id="floatingInput"
                          placeholder="a"
                          required
                        />
                        <label for="floatingInput">Direccion</label>
                      </div>
                      <div class="form-floating mb-3">
                        <input
                          type="text"
                          class="form-control"
                          id="floatingInput"
                          placeholder="a"
                        />
                        <label for="floatingInput">Pais</label>
                      </div>
                      <div class="form-floating mb-3">
                        <input
                          type="text"
                          class="form-control"
                          id="floatingInput"
                          placeholder="a"
                          required
                        />
                        <label for="floatingInput">Ciudad</label>
                      </div>
                      <div class="form-floating mb-3">
                        <input
                          type="text"
                          class="form-control"
                          id="floatingInput"
                          placeholder="a"
                          required
                        />
                        <label for="floatingInput">Codigo Postal</label>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Acordion Item 3 -->
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#flush-collapseThree"
                      aria-expanded="false"
                      aria-controls="flush-collapseThree"
                    >
                      Metodo de pago
                    </button>
                  </h2>
                  <div
                    id="flush-collapseThree"
                    class="accordion-collapse collapse"
                    data-bs-parent="#accordionFlush"
                  >
                    <div class="accordion-body">
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                        <label class="form-check-label" for="flexRadioDefault1">
                          Tarjeta de credito
                        </label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1" checked>
                        <label class="form-check-label" for="flexRadioDefault2">
                          Transferencia Bancaria
                        </label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                        <label class="form-check-label" for="flexRadioDefault1">
                          MercadoPago
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="d-grid gap-2">
              <button class="btn btn-outline-dark" type="submit" style="margin-top: 10px">Enviar</button>
            </div>
          </form>
        </div>
      </div>
    </main>

    <%- include("partials/footer") %>
    <%- include("partials/globalScripts") %>

    <script>
      const array = <%- JSON.stringify(array) %>
      function incrementQuantity(cardIndex) {
        const quantityElement = document.getElementById(`quantity_${cardIndex}`);
        const currentQuantity = parseInt(quantityElement.innerText, 10);
        quantityElement.innerText = (currentQuantity + 1).toString();
        updateSubtotal();
      }
    
      function decrementQuantity(cardIndex) {
        const quantityElement = document.getElementById(`quantity_${cardIndex}`);
        const currentQuantity = parseInt(quantityElement.innerText, 10);
        if (currentQuantity > 1) {
          quantityElement.innerText = (currentQuantity - 1).toString();
        } else {
          quantityElement.innerText = "0";
          document.getElementById(`product_${cardIndex}`).classList.add('hidden');
        }
        updateSubtotal();
      }
    
      function resetQuantity(cardIndex) {
        const quantityElement = document.getElementById(`quantity_${cardIndex}`);
        quantityElement.innerText = "0";
        document.getElementById(`product_${cardIndex}`).classList.add('hidden');
        updateSubtotal();
      }
    
      function calculateProductSubtotal(cardIndex) {
      const quantityElement = document.getElementById(`quantity_${cardIndex}`);
      const currentQuantity = parseInt(quantityElement.innerText, 10);
      const priceElement = document.querySelector(`#product_${cardIndex} .image-text.c`);
      const price = parseFloat(priceElement.textContent.replace("$", "").trim());

      const productCard = document.getElementById(`product_${cardIndex}`);
      if (currentQuantity === 0) {
        productCard.classList.add(`card-items-${cardIndex}`);
      } else {
        productCard.classList.remove(`card-items-${cardIndex}`);
      }

      return price * currentQuantity;
    }

      function updateSubtotal() {
        let subtotal = 0;
        for (let index = 0; index < array.length; index++) {
          subtotal += calculateProductSubtotal(index);
        }
    
        const subtotalElement = document.getElementById("subtotal");
        subtotalElement.textContent = "$" + subtotal.toFixed(2);
      }
    
      document.addEventListener("click", function (event) {
        if (event.target.matches('.btn.btn-outline-success') || event.target.matches('.btn.btn-outline-success i')) {
          const card = event.target.closest(".card-items");
          if (!card) return; // Not inside a product card
          const cardIndex = card.id.split("_")[1];
    
          if (event.target.classList.contains("mipha") || event.target.parentNode.classList.contains("mipha")) {
            incrementQuantity(cardIndex);
          } else if (event.target.classList.contains("daruk") || event.target.parentNode.classList.contains("daruk")) {
            resetQuantity(cardIndex);
          } else if (event.target.classList.contains("tulin") || event.target.parentNode.classList.contains("tulin")) {
            decrementQuantity(cardIndex);
          }
        }
      });
    
      updateSubtotal();
    </script>
    
    
  </body>
</html>